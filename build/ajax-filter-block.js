(()=>{"use strict";const e=window.wp.element,{registerBlockType:t}=wp.blocks,{SelectControl:n,PanelBody:a}=wp.components,{useState:o,useEffect:l}=wp.element,{apiFetch:p}=wp;t("artpulse/ajax-filter",{title:"AJAX Taxonomy Filter",icon:"filter",category:"widgets",attributes:{postType:{type:"string",default:"ead_artist"},taxonomy:{type:"string",default:"artist_specialty"}},edit({attributes:t,setAttributes:r}){const{postType:i,taxonomy:s}=t,[c,d]=o([]),[m,u]=o([]);return l(()=>{p({path:"/wp/v2/types"}).then(e=>{const t=Object.entries(e).filter(([e])=>e.startsWith("ead_"));d(t.map(([e])=>({label:e,value:e})))})},[]),l(()=>{i?p({path:`/wp/v2/types/${i}`}).then(e=>{u(Object.keys(e.taxonomies||{}).map(e=>({label:e,value:e})))}):u([])},[i]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a,{title:"Settings",initialOpen:!0},(0,e.createElement)(n,{label:"Post Type",value:i,options:c,onChange:e=>r({postType:e,taxonomy:""})}),(0,e.createElement)(n,{label:"Taxonomy",value:s,options:m,onChange:e=>r({taxonomy:e})})),(0,e.createElement)("p",null,"This block renders a live filter widget on the frontend."))},save:()=>null}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".artpulse-ajax-filter-block").forEach(e=>{const t=e.dataset.postType,n=e.dataset.taxonomy;if(!t||!n)return;const a=document.createElement("div");a.className="ap-ajax-filter-controls";const o=document.createElement("div");function l(e=1){const p=Array.from(a.querySelectorAll("input[type=checkbox]:checked")).map(e=>e.value);let r=`/artpulse/v1/filtered-posts?post_type=${t}&taxonomy=${n}&per_page=5&page=${e}`;p.length&&(r+=`&terms=${p.join(",")}`),o.innerHTML="<p>Loadingâ€¦</p>",wp.apiFetch({path:r}).then(t=>{if(!t.posts.length)return void(o.innerHTML="<p>No posts found.</p>");const n=document.createElement("ul");if(t.posts.forEach(e=>{const t=document.createElement("li"),a=document.createElement("a");a.href=e.link,a.textContent=e.title,a.target="_blank",a.rel="noopener noreferrer",t.appendChild(a),n.appendChild(t)}),o.innerHTML="",o.appendChild(n),t.totalPages>1){const n=document.createElement("div");if(n.className="ap-ajax-filter-pagination",e>1){const t=document.createElement("button");t.textContent="Previous",t.onclick=()=>l(e-1),n.appendChild(t)}const a=document.createElement("span");if(a.textContent=` Page ${e} of ${t.totalPages} `,n.appendChild(a),e<t.totalPages){const t=document.createElement("button");t.textContent="Next",t.onclick=()=>l(e+1),n.appendChild(t)}o.appendChild(n)}})}o.className="ap-ajax-filter-results",e.appendChild(a),e.appendChild(o),wp.apiFetch({path:`/wp/v2/${n}?per_page=100`}).then(e=>{e.length?(e.forEach(e=>{const t=document.createElement("label");t.style.marginRight="10px";const n=document.createElement("input");n.type="checkbox",n.value=e.slug,t.appendChild(n),t.appendChild(document.createTextNode(" "+e.name)),a.appendChild(t),n.addEventListener("change",()=>l())}),l()):o.textContent="No filter terms available."})})})})();