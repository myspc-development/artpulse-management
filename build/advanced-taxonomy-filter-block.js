(()=>{"use strict";const e=window.wp.element,{registerBlockType:t}=wp.blocks,{SelectControl:l,Spinner:a,Button:n}=wp.components,{InspectorControls:r}=wp.blockEditor,{useState:o,useEffect:s}=wp.element,{apiFetch:p}=wp;t("artpulse/advanced-taxonomy-filter",{title:"Advanced Taxonomy Filter",icon:"filter",category:"widgets",attributes:{postType:{type:"string",default:"ead_artist"},taxonomy:{type:"string",default:"artist_specialty"}},edit:t=>{const{attributes:i,setAttributes:c}=t,{postType:m,taxonomy:u}=i,[d,y]=o([]),[b,g]=o([]),[h,v]=o([]),[E,w]=o(""),[f,T]=o([]),[x,k]=o(1),[_,C]=o(1),[$,P]=o(!1);s(()=>{p({path:"/wp/v2/types"}).then(e=>{const t=Object.entries(e).filter(([e,t])=>t.rest_base&&e.startsWith("ead_")).map(([e])=>e);y(t)})},[]),s(()=>{m?p({path:`/wp/v2/types/${m}`}).then(e=>{g(Object.keys(e.taxonomies||{})),w("")}):g([])},[m]),s(()=>{if(!u)return v([]),void w("");p({path:`/wp/v2/${u}?per_page=100`}).then(v)},[u]);const F=(e=1)=>{P(!0);let t=`/wp/v2/${m}?per_page=5&page=${e}`;E&&(t+=`&tax_${u}=${E}`),p({path:t}).then((t,l)=>{T(t),C(parseInt(l.headers.get("X-WP-TotalPages"),10)||1),k(e),P(!1)}).catch(()=>{T([]),P(!1)})};return s(()=>{F()},[m,u,E]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(r,null,(0,e.createElement)(l,{label:"Post Type",value:m,options:d.map(e=>({label:e,value:e})),onChange:e=>c({postType:e,taxonomy:"",selectedTerm:""})}),b.length>0&&(0,e.createElement)(l,{label:"Taxonomy",value:u,options:b.map(e=>({label:e,value:e})),onChange:e=>c({taxonomy:e,selectedTerm:""})}),h.length>0&&(0,e.createElement)(l,{label:"Filter by Term",value:E,options:[{label:"All",value:""},...h.map(e=>({label:e.name,value:e.slug}))],onChange:e=>w(e)})),$?(0,e.createElement)(a,null):(0,e.createElement)("div",null,(0,e.createElement)("ul",null,f.map(t=>(0,e.createElement)("li",{key:t.id},(0,e.createElement)("a",{href:t.link,target:"_blank",rel:"noopener noreferrer"},t.title.rendered||"(No title)")))),(0,e.createElement)("div",null,(0,e.createElement)(n,{isDisabled:x<=1,onClick:()=>F(x-1)},"Prev"),(0,e.createElement)("span",null," Page ",x," of ",_," "),(0,e.createElement)(n,{isDisabled:x>=_,onClick:()=>F(x+1)},"Next"))))},save:()=>null})})();