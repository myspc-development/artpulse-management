# ArtPulse Mobile API

Base path: `/wp-json/artpulse/v1/mobile`

All endpoints (except `POST /login`) require a Bearer token generated by the login endpoint. Tokens are JWTs signed with the WordPress auth key and expire after 24 hours.

## Authentication

### `POST /login`

Request body (JSON or form encoded):

```json
{
  "username": "user@example.com",
  "password": "secret",
  "push_token": "optional-device-token"
}
```

Returns a token and the authenticated user profile. When `push_token` is supplied it is stored in the user's meta for later notifications.

### `GET /me`

Requires `Authorization: Bearer <token>` header. Returns the authenticated user's profile, including any stored push token.

## Events

### `GET /events`

Query params:

- `lat` and `lng` (required) – decimal degrees for the lookup.
- `radius` (optional, default 50 km) – search radius in kilometres.
- `limit` (optional, default 25, max 100) – number of events to return.

Results are ordered by distance (ascending) and then by start time. Each event includes the best available image URL, like/save counts, and the caller's interaction state.

### `POST /events/{id}/like`
### `DELETE /events/{id}/like`

Marks an event as liked/unliked. Responses include the updated counts and interaction flags. Duplicate likes are ignored (idempotent).

### `POST /events/{id}/save`
### `DELETE /events/{id}/save`

Persist or remove a save for the event. Responses mirror the like endpoints.

## Following and Feed

### `POST /follow/{type}/{id}`
### `DELETE /follow/{type}/{id}`

`type` must be `artist` or `org`. Responses include the updated follower count and whether the caller is following.

### `GET /feed`

Returns upcoming events connected to the organisations and artists the user follows. When no matches are found the feed falls back to upcoming public events.

## Rate limiting

Write endpoints are rate-limited per user and IP. If a limit is exceeded the API responds with HTTP `429` and a `retry_after` hint.

## Data backfill

CLI helpers:

```bash
wp artpulse backfill-event-geo
```

Rebuilds the `ap_event_geo` mirror table from stored event coordinates.
